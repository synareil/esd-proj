<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <style>
      .item-quantity {
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 120px;
      }

      .item-quantity button {
        width: 30px;
        height: 30px;
        border: none;
        border-radius: 50%;
        background-color: #f0f0f0;
        color: #333;
        font-size: 20px;
        line-height: 30px;
        text-align: center;
      }

      .item-quantity span {
        font-size: 18px;
      }
    </style>
</head>
<body>
    <div id="nav-placeholder"></div>
    <!--Vue app - to make the data dynamic. -->
  <div id="app">
    <div class="container mt-5">
      <div class="row">
        <div class="col-lg-8">
          <div class="mb-3">
            <div class="pt-4">

              <!--Items in the shopping cart-->
              <div v-if="shoppingItems.length === 0">
                No items in the cart.
              </div>

              <div v-else>
                <div v-for="(item, index) in shoppingItems" :key="index">

                  <div class="row mb-4">
                    <div class="col-md-5 col-lg-3 col-xl-3">
                      <div class="view zoom overlay z-depth-1 rounded mb-3 mb-md-0">
                        <img class="img-fluid w-100" :src="item.img" :alt="item.name">
                      </div>
                    </div>
                    <div class="col-md-7 col-lg-9 col-xl-9">
                      <div>
                        <div class="d-flex justify-content-between">
                          <div>
                            <h5>{{item.name }}</h5>
                            <p class="mb-3 text-muted text-uppercase small">{{item.description }}</p>
                          </div>
                          <div>
                            <div class="d-flex justify-content-between align-items-center mr-2">
                              <h6 class="mb-0">Quantity: </h6>
                              <div class="cart-item">
                                <div class="item-quantity mx-2">
                                  <button @click="decrementQuantity(index)">-</button>
                                  <span>{{item.qty }}</span>
                                  <button @click="incrementQuantity(index)">+</button>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                          <div>
                            <a href="#!" type="button" class="card-link-secondary small text-uppercase mr-3"><i class="fas fa-trash-alt mr-1"></i> Remove item </a>
                          </div>
                          <p v-if="item.salesPrice > 0" class="mb-0 mr-2">
                            <span>
                              <s>${{item.price}}</s>
                            </span>
                            <span>
                              <strong class='text-danger'>${{item.price - item.salesPrice }}</strong>
                            </span>
                          </p>
                          <p v-else-if="item.salesPrice === 0" class="mb-0 mr-2"><span><strong>${{item.price }}</strong></span></p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-lg-4">
          <div class="mb-3">
            <div class="pt-4">
              <h5 class="mb-3">Your Total</h5>
              <ul class="list-group list-group-flush">
                <li class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 pb-0">
                  Total Amount
                  <span>${{total_price }}</span>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                  Discount
                  <span>-(${{total_sales }})</span>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                  Shipping
                  <span class="text-danger">FREE</span>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 mb-3">
                  <div>
                    <strong>Total amount </strong>
                    <strong>
                      <p class="mb-0">(including GST)</p>
                    </strong>
                  </div>
                  <span><strong>${{total_payment_price }}</strong></span>
                </li>
              </ul>
              <button type="button" class="btn btn-primary btn-block w-100" style="font-size: 20px; padding: 10px 0;">Checkout</button>
            </div>
          </div>
        </div>
        
      </div>
    </div>
  </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.min.js"></script>
  <script>

    //for navigation bar
    (async function() {
      const response = await fetch('./nav.html');
      const data = await response.text();
      document.getElementById('nav-placeholder').innerHTML = data;

      // Get the filename of the current page
      const page = window.location.pathname.split("/").pop().split(".")[0];

      // Get the nav link element that corresponds to the current page
      const link = document.getElementById(page);

      // Add the 'active' class to the nav link
      if (link) link.classList.add("active");
    })();

    new Vue({
      el: '#app',
      data: {
        shoppingItems: [],
        total_price: 0,
        total_payment_price: 0,
        total_sales: 0
      },
      created() {
        this.loadItems();
      },
      methods: {
        loadItems() {
          // Simulated data
          var data = [
            {
              "ItemID": 1,
              "name": "item1",
              "description": "This is item #1",
              "qty": 3,
              "price": 100.00,
              "salesPrice": 10.00,
              "img": "assets/img/littlefuzzyss.jpg"
            },
            {
              "itemID": 2,
              "name": "item2",
              "description": "This is item #2",
              "qty": 3,
              "price": 100.00,
              "salesPrice": 0.00,
              "img": "assets/img/littlefuzzyss.jpg"
            },
            {
              "itemID": 3,
              "name": "item3",
              "description": "This is item #3",
              "qty": 1,
              "price": 100.00,
              "salesPrice": 0.00,
              "img": "assets/img/littlefuzzyss.jpg"
            },
          ];

          this.shoppingItems = data;
          this.calculateTotals();
        },
        decrementQuantity(index) {
          if (this.shoppingItems[index].qty > 1) {
            this.shoppingItems[index].qty--;
            this.calculateTotals();
          }
        },
        incrementQuantity(index) {
          this.shoppingItems[index].qty++;
          this.calculateTotals();
        },
        calculateTotals() {
          this.total_price = this.shoppingItems.reduce((acc, item) => acc + (item.price * item.qty), 0);
          this.total_sales = this.shoppingItems.reduce((acc, item) => acc + (item.salesPrice * item.qty), 0);
          this.total_payment_price = this.total_price - this.total_sales;
        }
      }
    });
  </script>
  
  <!-- Bootstrap -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
  crossorigin="anonymous"></script>
</body>
</html>